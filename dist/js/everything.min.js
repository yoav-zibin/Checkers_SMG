var gameLogic;!function(a){function b(a){var b;for(b in a)if(!a.prop)return!1;return!0}function c(a){return a.substr(0,1)}function d(a){return a.substr(1)}function e(a,b){return a.row!==b.row?!1:a.col===b.col}function f(a,b){for(var c=0;c<a.length;c+=1)if(e(a[c],b))return!0;return!1}function g(b,c){return b===a.CONSTANTS.BLACK_INDEX&&c===a.CONSTANTS.BLACK||b===a.CONSTANTS.WHITE_INDEX&&c===a.CONSTANTS.WHITE}function h(b){var c,d,e=b.row,f=b.col;return b.hasOwnProperty("row")&&b.hasOwnProperty("col")?0>e||e>=a.CONSTANTS.ROW||0>f||f>=a.CONSTANTS.COLUMN?!1:(c=e%2===0,d=f%2===0,!!(!c&&d||c&&!d)):!1}function i(b,e,f){var g=b[e.row][e.col];if(d(g)===a.CONSTANTS.KING){if(1===Math.abs(e.row-f.row)&&1===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.BLACK){if(e.row-f.row===-1&&1===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.WHITE&&e.row-f.row===1&&1===Math.abs(e.col-f.col))return!0;return!1}function j(b,e,f){var g=b[e.row][e.col];if(d(g)===a.CONSTANTS.KING){if(2===Math.abs(e.row-f.row)&&2===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.BLACK){if(e.row-f.row===-2&&2===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.WHITE&&e.row-f.row===2&&2===Math.abs(e.col-f.col))return!0;return!1}function k(b,c,d){return c!==a.CONSTANTS.DARK_SQUARE&&b.substr(0,1)!==c.substr(0,1)&&d===a.CONSTANTS.DARK_SQUARE}function l(b,c){return c===a.CONSTANTS.WHITE_INDEX&&0===b.row||c===a.CONSTANTS.BLACK_INDEX&&b.row===a.CONSTANTS.ROW-1}function m(a,b,c){var d={row:-1,col:-1};if(!h(a))throw new Error("Illegal from coordinate!!!");switch(b){case E.SIMPLE_MOVE:switch(c){case D.UP_LEFT:d.row=a.row-1,d.col=a.col-1;break;case D.UP_RIGHT:d.row=a.row-1,d.col=a.col+1;break;case D.DOWN_LEFT:d.row=a.row+1,d.col=a.col-1;break;case D.DOWN_RIGHT:d.row=a.row+1,d.col=a.col+1;break;default:throw new Error("Illegal direction!")}break;case E.JUMP_MOVE:switch(c){case D.UP_LEFT:d.row=a.row-2,d.col=a.col-2;break;case D.UP_RIGHT:d.row=a.row-2,d.col=a.col+2;break;case D.DOWN_LEFT:d.row=a.row+2,d.col=a.col-2;break;case D.DOWN_RIGHT:d.row=a.row+2,d.col=a.col+2;break;default:throw new Error(C.ILLEGAL_MOVE)}break;default:throw new Error(C.ILLEGAL_MOVE)}if(!h(d))throw new Error(C.ILLEGAL_DELTA);return d}function n(b,c){var d,e,f=[];return 0===c.row?f:(c.row%2===0?(d=m(c,E.SIMPLE_MOVE,D.UP_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d),c.col!==a.CONSTANTS.COLUMN-1&&(e=m(c,E.SIMPLE_MOVE,D.UP_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e))):(0!==c.col&&(d=m(c,E.SIMPLE_MOVE,D.UP_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d)),e=m(c,E.SIMPLE_MOVE,D.UP_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e)),f)}function o(b,c){var d,e,f=[];return c.row===a.CONSTANTS.ROW-1?f:(c.row%2===0?(d=m(c,E.SIMPLE_MOVE,D.DOWN_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d),c.col!==a.CONSTANTS.COLUMN-1&&(e=m(c,E.SIMPLE_MOVE,D.DOWN_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e))):(0!==c.col&&(d=m(c,E.SIMPLE_MOVE,D.DOWN_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d)),e=m(c,E.SIMPLE_MOVE,D.DOWN_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e)),f)}function p(a,b){var c={row:-1,col:-1};if(!h(a)||!h(b))throw new Error("Illegal coordinate!!!");return 2===Math.abs(a.row-b.row)&&2===Math.abs(a.col-b.col)&&(c.row=(a.row+b.row)/2,c.col=(a.col+b.col)/2),c}function q(b,c){var d,e,f,g,h=[],i=c,j=b[c.row][c.col];return i.row<2?h:(i.col>1&&(f=m(c,E.JUMP_MOVE,D.UP_LEFT),d=p(i,f),g=b[f.row][f.col],e=b[d.row][d.col],k(j,e,g)&&h.push(f)),i.col<a.CONSTANTS.COLUMN-2&&(f=m(c,E.JUMP_MOVE,D.UP_RIGHT),d=p(i,f),g=b[f.row][f.col],e=b[d.row][d.col],k(j,e,g)&&h.push(f)),h)}function r(b,c){var d,e,f,g,h=c,i=b[c.row][c.col],j=[];return h.row>a.CONSTANTS.ROW-3?j:(h.col>1&&(f=m(c,E.JUMP_MOVE,D.DOWN_LEFT),d=p(h,f),g=b[f.row][f.col],e=b[d.row][d.col],k(i,e,g)&&j.push(f)),h.col<a.CONSTANTS.COLUMN-2&&(f=m(c,E.JUMP_MOVE,D.DOWN_RIGHT),d=p(h,f),g=b[f.row][f.col],e=b[d.row][d.col],k(i,e,g)&&j.push(f)),j)}function s(b,c,d){var e=[],f=[],h=b[c.row][c.col],i=h.substr(0,1),j=h.substr(1);return g(d,i)&&(j===a.CONSTANTS.KING?(f=n(b,c),e=e.concat(f),f=o(b,c),e=e.concat(f)):i===a.CONSTANTS.WHITE?(f=n(b,c),e=e.concat(f)):i===a.CONSTANTS.BLACK&&(f=o(b,c),e=e.concat(f))),e}function t(b,c,d){var e=[],f=[],h=b[c.row][c.col],i=h.substr(0,1),j=h.substr(1);return g(d,i)&&(j===a.CONSTANTS.KING?(f=q(b,c),e=e.concat(f),f=r(b,c),e=e.concat(f)):i===a.CONSTANTS.WHITE?(f=q(b,c),e=e.concat(f)):i===a.CONSTANTS.BLACK&&(f=r(b,c),e=e.concat(f))),e}function u(a,b,c){var d;return d=t(a,b,c),0===d.length&&(d=s(a,b,c)),d}function v(b,d){var e,f,g,h,i,j=[],k={row:-1,col:-1};for(h=0;h<a.CONSTANTS.ROW;h+=1)for(i=0;i<a.CONSTANTS.COLUMN&&(c(b[h][i])===a.CONSTANTS.WHITE?e=!0:c(b[h][i])===a.CONSTANTS.BLACK&&(f=!0),e!==!0||f!==!0);i+=1);if(e&&!f)return a.CONSTANTS.WHITE;if(!e&&f)return a.CONSTANTS.BLACK;for(h=0;h<a.CONSTANTS.ROW;h+=1)for(i=0;i<a.CONSTANTS.COLUMN;i+=1)k.row=h,k.col=i,g=b[h][i],j=d===a.CONSTANTS.BLACK_INDEX?j.concat(u(b,k,1-d)):j.concat(u(b,k,1-d));return 0===j.length?d===a.CONSTANTS.BLACK_INDEX?a.CONSTANTS.BLACK:a.CONSTANTS.WHITE:""}function w(b,c){var d,e,f=[],g={row:-1,col:-1};for(d=0;d<a.CONSTANTS.ROW;d+=1)for(e=0;e<a.CONSTANTS.COLUMN;e+=1)g.row=d,g.col=e,f=f.concat(t(b,g,c));return f.length>0}function x(b,d,e,g){b=b?angular.copy(b):B();var k,m,n,o=!1,q=!1,r=b[d.row][d.col].substr(1);if(!h(d)||!h(e))throw new Error(C.ILLEGAL_DELTA);if(i(b,d,e)?q=!0:j(b,d,e)&&(o=!0),q){if(w(b,g))throw new Error(C.ILLEGAL_IGNORE_MANDATORY_JUMP);if(k=s(b,d,g),!f(k,e))throw new Error(C.ILLEGAL_SIMPLE_MOVE)}else{if(!o)throw new Error(C.ILLEGAL_MOVE);var u=t(b,d,g);if(!f(u,e))throw new Error(C.ILLEGAL_JUMP_MOVE)}q?(b[e.row][e.col]=b[d.row][d.col],b[d.row][d.col]=a.CONSTANTS.DARK_SQUARE):o&&(n=p(d,e),b[e.row][e.col]=b[d.row][d.col],b[d.row][d.col]=a.CONSTANTS.DARK_SQUARE,b[n.row][n.col]=a.CONSTANTS.DARK_SQUARE);var x=l(e,g);x&&(c(b[e.row][e.col])===a.CONSTANTS.BLACK?b[e.row][e.col]=a.CONSTANTS.BLACK_KING:c(b[e.row][e.col])===a.CONSTANTS.WHITE&&(b[e.row][e.col]=a.CONSTANTS.WHITE_KING)),m=v(b,g);var y,z,A=o&&t(b,e,g).length>0;""===m||A?(y=null,z=A?x&&r!==a.CONSTANTS.KING?1-g:g:1-g):(z=-1,y=m===a.CONSTANTS.WHITE?[1,0]:[0,1]);var D={miniMoves:[{fromDelta:d,toDelta:e}],board:b};return{endMatchScores:y,turnIndexAfterMove:z,stateAfterMove:D}}function y(a,b,c){if(0===b.length)throw new Error("Must have at least one mini-move");for(var d=null,e=0,f=b;e<f.length;e++){var g=f[e];if(d&&d.turnIndexAfterMove!==c)throw new Error("Mini-moves must be done by the same player");d=x(a,g.fromDelta,g.toDelta,c),a=angular.copy(d.stateAfterMove.board)}return d.stateAfterMove.miniMoves=b,d}function z(){return{endMatchScores:null,turnIndexAfterMove:0,stateAfterMove:{miniMoves:[],board:B()}}}function A(a){var b=a.turnIndexBeforeMove,c=a.stateBeforeMove,d=a.move;if(c||0!==b||!angular.equals(z(),d)){for(var e=d.stateAfterMove,f=e.miniMoves,g=null,h=0,i=f;h<i.length;h++){var j=i[h],k=j.fromDelta;if(g&&!angular.equals(g,k))throw new Error("The same piece must make all moves, BUT currentPiecePosition="+angular.toJson(g,!0)+" fromDelta="+angular.toJson(k,!0));g=j.toDelta}var l=c?c.board:null,m=y(l,f,b);if(!angular.equals(d,m))throw new Error("Expected move="+angular.toJson(m,!0)+", but got stateTransition="+angular.toJson(a,!0))}}function B(){return[["--","BM","--","BM","--","BM","--","BM"],["BM","--","BM","--","BM","--","BM","--"],["--","BM","--","BM","--","BM","--","BM"],["DS","--","DS","--","DS","--","DS","--"],["--","DS","--","DS","--","DS","--","DS"],["WM","--","WM","--","WM","--","WM","--"],["--","WM","--","WM","--","WM","--","WM"],["WM","--","WM","--","WM","--","WM","--"]]}a.ENUM={ILLEGAL_CODE:{ILLEGAL_MOVE:"ILLEGAL_MOVE",ILLEGAL_SIMPLE_MOVE:"ILLEGAL_SIMPLE_MOVE",ILLEGAL_JUMP_MOVE:"ILLEGAL_JUMP_MOVE",ILLEGAL_DELTA:"ILLEGAL_DELTA",ILLEGAL_COLOR_CHANGED:"ILLEGAL_COLOR_CHANGED",ILLEGAL_CROWNED:"ILLEGAL_CROWNED",ILLEGAL_UNCROWNED:"ILLEGAL_UNCROWNED",ILLEGAL_IGNORE_MANDATORY_JUMP:"ILLEGAL_IGNORE_MANDATORY_JUMP",ILLEGAL_SET_TURN:"ILLEGAL_SET_TURN",ILLEGAL_END_MATCH_SCORE:"ILLEGAL_END_MATCH_SCORE",ILLEGAL_CODE:"ILLEGAL_CODE"},DIRECTION:{UP_LEFT:"UP_LEFT",UP_RIGHT:"UP_RIGHT",DOWN_LEFT:"DOWN_LEFT",DOWN_RIGHT:"DOWN_RIGHT"},MOVE_TYPE:{SIMPLE_MOVE:"SIMPLE_MOVE",JUMP_MOVE:"JUMP_MOVE"}};var C=a.ENUM.ILLEGAL_CODE,D=a.ENUM.DIRECTION,E=a.ENUM.MOVE_TYPE;a.CONSTANTS={ROW:8,COLUMN:8,LIGHT_SQUARE:"--",DARK_SQUARE:"DS",BLACK_MAN:"BM",BLACK_KING:"BK",WHITE_MAN:"WM",WHITE_KING:"WK",BLACK:"B",WHITE:"W",MAN:"M",KING:"K",WHITE_INDEX:0,BLACK_INDEX:1},a.isEmptyObj=b,a.getColor=c,a.getKind=d,a.isOwnColor=g,a.isSimpleMove=i,a.isJumpMove=j,a.getJumpedDelta=p,a.getSimpleMoves=s,a.getJumpMoves=t,a.getAllPossibleMoves=u,a.getWinner=v,a.hasMandatoryJumps=w,a.createMiniMove=x,a.createMove=y,a.createInitialMove=z,a.checkMoveOk=A,a.getInitialBoard=B}(gameLogic||(gameLogic={}));var game;!function(a){function b(){return{}}function c(){if(!a.currentUpdateUI||!a.currentUpdateUI.move)return void log.warn("Got stateForOgImage without currentUpdateUI!");var b=a.currentUpdateUI.move.endMatchScores?a.currentUpdateUI.stateBeforeMove:a.currentUpdateUI.move.stateAfterMove;if(!b)return"";for(var c=b.board,d="",e=0;8>e;e++)for(var f=0;8>f;f++){var g=1==a.currentUpdateUI.yourPlayerIndex?c[e][7-f]:c[7-e][f];if("--"==g||"DS"==g)d+="x";else{var h=g.substr(0,1),i=g.substr(1,1);d+=("W"==h?"B":"W")+i}}return d}function d(){if(log.alwaysLog("Checkers version 1.3"),e(),_=document.getElementById("gameArea"),!_)throw new Error("Can't find gameArea div!");translate.setTranslations(b()),translate.setLanguage("en"),resizeGameAreaService.setWidthToHeight(1),moveService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,checkMoveOk:gameLogic.checkMoveOk,updateUI:i,getStateForOgImage:c}),dragAndDropService.addDragListener("gameArea",S)}function e(){if("serviceWorker"in navigator){var a=navigator;log.log("Calling serviceWorker.register"),a.serviceWorker.register("service-worker.js").then(function(a){log.log("ServiceWorker registration successful with scope: ",a.scope)})["catch"](function(a){log.log("ServiceWorker registration failed: ",a)})}}function f(){a.animationInterval=$interval(h,700)}function g(){a.animationInterval&&($interval.cancel(a.animationInterval),a.animationInterval=null)}function h(){if(0==a.remainingAnimations.length)return g(),void j();var b=a.remainingAnimations.shift(),c=gameLogic.createMiniMove(a.board,b.fromDelta,b.toDelta,a.currentUpdateUI.turnIndexBeforeMove);if(a.board=c.stateAfterMove.board,0==a.remainingAnimations.length){var d=a.currentUpdateUI.move.stateAfterMove.board;if(!angular.equals(a.board,d))throw new Error("Animations ended in a different board: expected="+angular.toJson(d,!0)+" actual after animations="+angular.toJson(a.board,!0))}Z()}function i(b){log.info("Game got updateUI:",b),a.hadLoadingError=!1,a.didMakeMove=!1,a.currentUpdateUI=b,R(),a.humanMiniMoves=[];var c=!a.lastHumanMove||!angular.equals(b.move.stateAfterMove,a.lastHumanMove.stateAfterMove);a.shouldRotateBoard=1===b.playMode,g(),a.remainingAnimations=[],l()?(a.board=gameLogic.getInitialBoard(),q()&&k(gameLogic.createInitialMove())):c?(a.board=b.stateBeforeMove?b.stateBeforeMove.board:b.move.stateAfterMove.board,b.stateBeforeMove||angular.equals(a.board,gameLogic.getInitialBoard())||(a.board=gameLogic.getInitialBoard()),a.remainingAnimations=angular.copy(b.move.stateAfterMove.miniMoves),f()):(a.board=b.move.stateAfterMove.board,f()),Z()}function j(){if(o()){var b=aiService.createComputerMove(a.board,m(),{millisecondsLimit:500});log.info("Computer move: ",b),k(b)}}function k(b){a.didMakeMove||(a.didMakeMove=!0,moveService.makeMove(b))}function l(){return!a.currentUpdateUI.move.stateAfterMove}function m(){return a.currentUpdateUI.yourPlayerIndex}function n(){var b=a.currentUpdateUI.playersInfo[a.currentUpdateUI.yourPlayerIndex];return b&&""===b.playerId}function o(){return q()&&n()}function p(){return q()&&!n()&&0==a.remainingAnimations.length}function q(){return!a.didMakeMove&&a.currentUpdateUI.move.turnIndexAfterMove>=0&&a.currentUpdateUI.yourPlayerIndex===a.currentUpdateUI.move.turnIndexAfterMove}function r(a){switch(a){case $.COLUMN+1:return"move_up_left";case $.COLUMN-1:return"move_up_right";case-$.COLUMN+1:return"move_down_left";case-$.COLUMN-1:return"move_down_right";case 2*$.COLUMN+2:return"jump_up_left";case 2*$.COLUMN-2:return"jump_up_right";case-(2*$.COLUMN)+2:return"jump_down_left";case-(2*$.COLUMN)-2:return"jump_down_right"}return log.error("Internal error: illegal idDiff=",a),""}function s(b,c){if(0==a.remainingAnimations.length)return"";var d=a.remainingAnimations[0].fromDelta,e=a.remainingAnimations[0].toDelta,f={row:(d.row+e.row)/2,col:(d.col+e.col)/2},g=w({row:b,col:c});if(d.row===g.row&&d.col===g.col){var h=u(d.row,d.col),i=u(e.row,e.col),j=h-i;return r(a.shouldRotateBoard?-j:j)}return f.row===g.row&&f.col===g.col?"explodePiece":""}function t(b,c){if(log.info("makeMiniMove from:",b," to: ",c),p()){var d={fromDelta:b,toDelta:c},e=null;try{e=gameLogic.createMove(a.board,[d],m())}catch(f){return void log.info(["Move is illegal:",f])}$rootScope.$apply(function(){a.board=e.stateAfterMove.board,a.humanMiniMoves.push(d),e.turnIndexAfterMove!==a.currentUpdateUI.move.turnIndexAfterMove&&(a.lastHumanMove=e=gameLogic.createMove(a.currentUpdateUI.move.stateAfterMove.board,a.humanMiniMoves,m()),k(a.lastHumanMove))})}}function u(a,b){return a*$.COLUMN+b}function v(a,b){return(a+b)%2==1}function w(b){return a.shouldRotateBoard?{row:$.ROW-b.row-1,col:$.COLUMN-b.col-1}:b}function x(b,c){var d=w({row:b,col:c});return a.board[d.row][d.col]}function y(a){return a.indexOf("graph.facebook.com")>0}function z(a){return ca?A(a):B(a)}function A(a){return C(a,"http:","https:")}function B(a){return C(a,"https:","http:")}function C(a,b,c){return 0===a.indexOf(b)?c+a.substr(b.length):a}function D(a){return ba&&y(a)?"//multiplayer-gaming.appspot.com/proxy/?fwdurl="+encodeURIComponent(B(a)):z(a)}function E(){a.hadLoadingError||(a.hadLoadingError=!0,F())}function F(){Z(),$rootScope.$apply()}function G(){return"file:"===location.protocol}function H(a){return a&&-1===a.indexOf("imgs/autoMatchAvatar.png")}function I(b){if(a.hadLoadingError)return"";if(G())return"http://graph.facebook.com/"+(1==b?"10153589934097337":"10153693068502449")+"/picture?height=200&width=400";a.shouldRotateBoard&&(b=1-b);var c=a.currentUpdateUI.playersInfo[b];if(!c)return"";var d=c.avatarImageUrl;if(!H(d))return"";var e=J(d);return D("http://graph.facebook.com/"+e+"/picture?height=200&width=400")}function J(a){var b=a.match(/graph[.]facebook[.]com[\/](\w+)[\/]/);return b?b[1]:""}function K(){return a.hadLoadingError?"":"transparent_board"}function L(a,b){return s(a,b)}function M(b,c){if(!a.dndStartPos)return U({row:b,col:c})?"can_drag_from_square":"";var d=w({row:a.dndStartPos.row,col:a.dndStartPos.col}),e=w({row:b,col:c});if(!p())return"";var f={fromDelta:d,toDelta:e};try{return gameLogic.createMove(a.board,[f],m()),"can_drop_on_square"}catch(g){}return""}function N(b,c){var d=a.cachedAvatarPieceSrc[b][c];if(!d)return"piece";var e=x(b,c),f=gameLogic.getColor(e);return f===$.BLACK?"piece avatar_piece lighter_avatar_piece":"piece avatar_piece darker_avatar_piece"}function O(b,c){var d=a.cachedAvatarPieceSrc[b][c];if(!d)return"";var e=x(b,c),f=gameLogic.getKind(e);if(f!==$.KING)return"";var g=gameLogic.getColor(e);return g===$.BLACK?"imgs/avatar_white_crown.svg":"imgs/avatar_black_crown.svg"}function P(b,c){if(a.hadLoadingError)return"";var d=x(b,c);if("--"==d||"DS"==d)return"";var e=gameLogic.getColor(d),f=e===$.BLACK?1:0,g=a.currentUpdateUI.playersInfo[f];if(!g)return"";var h=g.avatarImageUrl;return H(h)?D(h):G()?1==f?"http://graph.facebook.com/10153589934097337/picture":"http://graph.facebook.com/10153693068502449/picture":""}function Q(b,c){var d=a.cachedAvatarPieceSrc[b][c];if(d)return d;var e=x(b,c);switch(e){case"BM":return fa;case"BK":return ga;case"WM":return ha;case"WK":return ia}return""}function R(){a.dndStartPos=null,a.dndElem&&a.dndElem.removeAttribute("style"),a.dndElem=null}function S(b,c,d){var e=X(),f=Math.min(Math.max(c-_.offsetLeft,e.width/2),_.clientWidth-e.width/2),g=Math.min(Math.max(d-_.offsetTop,e.height/2),_.clientHeight-e.height/2),h={top:g-.605*e.height,left:f-.605*e.width};if("touchmove"===b)return void(a.dndStartPos&&V(h,e));var i={row:Math.floor($.ROW*g/_.clientHeight),col:Math.floor($.COLUMN*f/_.clientWidth)};if("touchstart"!==b){if("touchend"===b&&a.dndStartPos){var j={row:a.dndStartPos.row,col:a.dndStartPos.col},k={row:i.row,col:i.col};t(w(j),w(k)),V(W(a.dndStartPos.row,a.dndStartPos.col,e),e),R()}"touchend"!==b&&"touchcancel"!==b&&"touchleave"!==b||(R(),F())}else if(U(i)){a.dndStartPos=i,a.dndElem=document.getElementById("img_container_"+a.dndStartPos.row+"_"+a.dndStartPos.col);var l=a.dndElem.style;l["z-index"]=20,V(h,e),F()}}function T(b){return gameLogic.isOwnColor(m(),a.board[b.row][b.col].substring(0,1))}function U(b){var c=w(b);if(!p()||!T(c))return!1;if(!gameLogic.isOwnColor(m(),a.board[c.row][c.col].substr(0,1)))return!1;if(a.humanMiniMoves.length>0&&!angular.equals(c,a.humanMiniMoves[a.humanMiniMoves.length-1].toDelta))return!1;var d,e=a.humanMiniMoves.length>0||gameLogic.hasMandatoryJumps(a.board,m());return d=e?gameLogic.getJumpMoves(a.board,c,m()):gameLogic.getSimpleMoves(a.board,c,m()),d.length>0}function V(b,c){var d=a.dndElem.style,e=c.height/10,f=c.width/10,g=W(a.dndStartPos.row,a.dndStartPos.col,c),h=b.left-g.left+f,i=b.top-g.top+e,j="translate("+h+"px,"+i+"px) scale(1.2)";d.transform=j,d["-webkit-transform"]=j,d["will-change"]="transform"}function W(a,b,c){var d=a*c.height,e=b*c.width,f={top:d,left:e};return f}function X(){return{width:_.clientWidth/$.COLUMN,height:_.clientHeight/$.ROW}}function Y(){for(var a=[],b=0;8>b;b++)a.push([]);return a}function Z(){a.cachedBoardAvatar0=I(0),a.cachedBoardAvatar1=I(1),a.cachedBoardClass=K();for(var b=0;8>b;b++)for(var c=0;8>c;c++)a.cachedAvatarPieceSrc[b][c]=P(b,c),a.cachedSquareClass[b][c]=M(b,c),a.cachedPieceContainerClass[b][c]=L(b,c),a.cachedPieceClass[b][c]=N(b,c),a.cachedPieceSrc[b][c]=Q(b,c),a.cachedAvatarPieceCrown[b][c]=O(b,c)}var $=gameLogic.CONSTANTS,_=null;a.currentUpdateUI=null,a.board=null,a.shouldRotateBoard=!1,a.didMakeMove=!1,a.humanMiniMoves=[],a.lastHumanMove=null,a.remainingAnimations=[],a.animationInterval=null,a.dndStartPos=null,a.dndElem=null,a.hadLoadingError=!1,a.getStateForOgImage=c,a.init=d,a.updateUI=i,a.getAnimationClass=s,a.isDarkCell=v;var aa=navigator.userAgent.toLowerCase(),ba=aa.indexOf("iphone")>-1||aa.indexOf("ipod")>-1||aa.indexOf("ipad")>-1,ca="https:"===location.protocol;a.onImgError=E,a.getBoardAvatar=I,a.getBoardClass=K,a.getPieceContainerClass=L,a.getSquareClass=M,a.getPieceClass=N,a.getAvatarPieceCrown=O,a.getAvatarPieceSrc=P;var da="imgs/",ea=".png",fa=da+"black_man"+ea,ga=da+"black_cro"+ea,ha=da+"white_man"+ea,ia=da+"white_cro"+ea;a.getPieceSrc=Q,a.cachedSquareClass=Y(),a.cachedPieceContainerClass=Y(),a.cachedPieceClass=Y(),a.cachedAvatarPieceSrc=Y(),a.cachedPieceSrc=Y(),a.cachedAvatarPieceCrown=Y(),a.updateCache=Z}(game||(game={})),angular.module("myApp",["gameServices"]).run(function(){$rootScope.game=game,game.init()});var aiService;!function(a){function b(a,b,c){return gameLogic.getKind(a)===i.MAN?gameLogic.getColor(a)===i.WHITE?1===b?7:5:c===i.ROW-2?7:5:gameLogic.getKind(a)===i.KING?10:0}function c(a,c){var d,e,f,g,h,j=0,k=[[0,4,0,4,0,4,0,4],[4,0,3,0,3,0,3,0],[0,3,0,2,0,2,0,4],[4,0,2,0,1,0,3,0],[0,3,0,1,0,2,0,4],[4,0,2,0,2,0,3,0],[0,3,0,3,0,3,0,4],[4,0,4,0,4,0,4,0]];if(d=gameLogic.getWinner(a,c),d===i.WHITE)return Number.MIN_VALUE;if(d===i.BLACK)return Number.MAX_VALUE;for(g=0;g<i.ROW;g+=1)for(h=0;h<i.COLUMN;h+=1)e=a[g][h],e!==i.LIGHT_SQUARE&&e!==i.DARK_SQUARE&&(f=b(e,g,h)*k[g][h],gameLogic.getColor(e)===i.BLACK?j+=f:j-=f);return j}function d(a,b){return-c(a.stateAfterMove.board,b)}function e(a,b,c,d){for(var e=gameLogic.getJumpMoves(b,d,c),f=0,g=e;f<g.length;f++){for(var h=g[f],i=[],j=d,k=h,l=b;;){var m=gameLogic.createMiniMove(l,j,k,c);if(i.push({fromDelta:j,toDelta:k}),m.turnIndexAfterMove!==c)break;l=m.stateAfterMove.board,j=k,k=gameLogic.getJumpMoves(l,k,c)[0]}a.push(i)}}function f(a,b){for(var c=[],d=gameLogic.hasMandatoryJumps(a,b),f=0;f<i.ROW;f+=1)for(var g=0;g<i.COLUMN;g+=1)if(gameLogic.isOwnColor(b,a[f][g].substr(0,1))){var h={row:f,col:g};if(d)e(c,a,b,h);else for(var j=gameLogic.getSimpleMoves(a,h,b),k=0,l=j;k<l.length;k++){var m=l[k];c.push([{fromDelta:h,toDelta:m}])}}return c}function g(a,b){for(var c=a.stateAfterMove.board,d=f(c,b),e=[],g=0;g<d.length;g++)e[g]=gameLogic.createMove(angular.copy(c),d[g],b);return e}function h(a,b,c){return alphaBetaService.alphaBetaDecision({stateAfterMove:{board:a?a:gameLogic.getInitialBoard(),miniMoves:[]},endMatchScores:null,turnIndexAfterMove:null},b,g,d,null,c)}var i=gameLogic.CONSTANTS;a.createComputerMove=h}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map