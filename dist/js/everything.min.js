var gameLogic;!function(a){function b(a){var b;for(b in a)if(!a.prop)return!1;return!0}function c(a){return a.substr(0,1)}function d(a){return a.substr(1)}function e(a,b){return a.row!==b.row?!1:a.col===b.col}function f(a,b){for(var c=0;c<a.length;c+=1)if(e(a[c],b))return!0;return!1}function g(b,c){return b===a.CONSTANTS.BLACK_INDEX&&c===a.CONSTANTS.BLACK||b===a.CONSTANTS.WHITE_INDEX&&c===a.CONSTANTS.WHITE}function h(b){var c,d,e=b.row,f=b.col;return b.hasOwnProperty("row")&&b.hasOwnProperty("col")?0>e||e>=a.CONSTANTS.ROW||0>f||f>=a.CONSTANTS.COLUMN?!1:(c=e%2===0,d=f%2===0,!!(!c&&d||c&&!d)):!1}function i(b,e,f){var g=b[e.row][e.col];if(d(g)===a.CONSTANTS.KING){if(1===Math.abs(e.row-f.row)&&1===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.BLACK){if(e.row-f.row===-1&&1===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.WHITE&&e.row-f.row===1&&1===Math.abs(e.col-f.col))return!0;return!1}function j(b,e,f){var g=b[e.row][e.col];if(d(g)===a.CONSTANTS.KING){if(2===Math.abs(e.row-f.row)&&2===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.BLACK){if(e.row-f.row===-2&&2===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.WHITE&&e.row-f.row===2&&2===Math.abs(e.col-f.col))return!0;return!1}function k(b,c,d){return c!==a.CONSTANTS.DARK_SQUARE&&b.substr(0,1)!==c.substr(0,1)&&d===a.CONSTANTS.DARK_SQUARE}function l(b,c){return c===a.CONSTANTS.WHITE_INDEX&&0===b.row||c===a.CONSTANTS.BLACK_INDEX&&b.row===a.CONSTANTS.ROW-1}function m(a,b,c){var d={row:-1,col:-1};if(!h(a))throw new Error("Illegal from coordinate!!!");switch(b){case E.SIMPLE_MOVE:switch(c){case D.UP_LEFT:d.row=a.row-1,d.col=a.col-1;break;case D.UP_RIGHT:d.row=a.row-1,d.col=a.col+1;break;case D.DOWN_LEFT:d.row=a.row+1,d.col=a.col-1;break;case D.DOWN_RIGHT:d.row=a.row+1,d.col=a.col+1;break;default:throw new Error("Illegal direction!")}break;case E.JUMP_MOVE:switch(c){case D.UP_LEFT:d.row=a.row-2,d.col=a.col-2;break;case D.UP_RIGHT:d.row=a.row-2,d.col=a.col+2;break;case D.DOWN_LEFT:d.row=a.row+2,d.col=a.col-2;break;case D.DOWN_RIGHT:d.row=a.row+2,d.col=a.col+2;break;default:throw new Error(C.ILLEGAL_MOVE)}break;default:throw new Error(C.ILLEGAL_MOVE)}if(!h(d))throw new Error(C.ILLEGAL_DELTA);return d}function n(b,c){var d,e,f=[];return 0===c.row?f:(c.row%2===0?(d=m(c,E.SIMPLE_MOVE,D.UP_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d),c.col!==a.CONSTANTS.COLUMN-1&&(e=m(c,E.SIMPLE_MOVE,D.UP_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e))):(0!==c.col&&(d=m(c,E.SIMPLE_MOVE,D.UP_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d)),e=m(c,E.SIMPLE_MOVE,D.UP_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e)),f)}function o(b,c){var d,e,f=[];return c.row===a.CONSTANTS.ROW-1?f:(c.row%2===0?(d=m(c,E.SIMPLE_MOVE,D.DOWN_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d),c.col!==a.CONSTANTS.COLUMN-1&&(e=m(c,E.SIMPLE_MOVE,D.DOWN_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e))):(0!==c.col&&(d=m(c,E.SIMPLE_MOVE,D.DOWN_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d)),e=m(c,E.SIMPLE_MOVE,D.DOWN_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e)),f)}function p(a,b){var c={row:-1,col:-1};if(!h(a)||!h(b))throw new Error("Illegal coordinate!!!");return 2===Math.abs(a.row-b.row)&&2===Math.abs(a.col-b.col)&&(c.row=(a.row+b.row)/2,c.col=(a.col+b.col)/2),c}function q(b,c){var d,e,f,g,h=[],i=c,j=b[c.row][c.col];return i.row<2?h:(i.col>1&&(f=m(c,E.JUMP_MOVE,D.UP_LEFT),d=p(i,f),g=b[f.row][f.col],e=b[d.row][d.col],k(j,e,g)&&h.push(f)),i.col<a.CONSTANTS.COLUMN-2&&(f=m(c,E.JUMP_MOVE,D.UP_RIGHT),d=p(i,f),g=b[f.row][f.col],e=b[d.row][d.col],k(j,e,g)&&h.push(f)),h)}function r(b,c){var d,e,f,g,h=c,i=b[c.row][c.col],j=[];return h.row>a.CONSTANTS.ROW-3?j:(h.col>1&&(f=m(c,E.JUMP_MOVE,D.DOWN_LEFT),d=p(h,f),g=b[f.row][f.col],e=b[d.row][d.col],k(i,e,g)&&j.push(f)),h.col<a.CONSTANTS.COLUMN-2&&(f=m(c,E.JUMP_MOVE,D.DOWN_RIGHT),d=p(h,f),g=b[f.row][f.col],e=b[d.row][d.col],k(i,e,g)&&j.push(f)),j)}function s(b,c,d){var e=[],f=[],h=b[c.row][c.col],i=h.substr(0,1),j=h.substr(1);return g(d,i)&&(j===a.CONSTANTS.KING?(f=n(b,c),e=e.concat(f),f=o(b,c),e=e.concat(f)):i===a.CONSTANTS.WHITE?(f=n(b,c),e=e.concat(f)):i===a.CONSTANTS.BLACK&&(f=o(b,c),e=e.concat(f))),e}function t(b,c,d){var e=[],f=[],h=b[c.row][c.col],i=h.substr(0,1),j=h.substr(1);return g(d,i)&&(j===a.CONSTANTS.KING?(f=q(b,c),e=e.concat(f),f=r(b,c),e=e.concat(f)):i===a.CONSTANTS.WHITE?(f=q(b,c),e=e.concat(f)):i===a.CONSTANTS.BLACK&&(f=r(b,c),e=e.concat(f))),e}function u(a,b,c){var d;return d=t(a,b,c),0===d.length&&(d=s(a,b,c)),d}function v(b,d){var e,f,g,h,i,j=[],k={row:-1,col:-1};for(h=0;h<a.CONSTANTS.ROW;h+=1)for(i=0;i<a.CONSTANTS.COLUMN&&(c(b[h][i])===a.CONSTANTS.WHITE?e=!0:c(b[h][i])===a.CONSTANTS.BLACK&&(f=!0),e!==!0||f!==!0);i+=1);if(e&&!f)return a.CONSTANTS.WHITE;if(!e&&f)return a.CONSTANTS.BLACK;for(h=0;h<a.CONSTANTS.ROW;h+=1)for(i=0;i<a.CONSTANTS.COLUMN;i+=1)k.row=h,k.col=i,g=b[h][i],j=d===a.CONSTANTS.BLACK_INDEX?j.concat(u(b,k,1-d)):j.concat(u(b,k,1-d));return 0===j.length?d===a.CONSTANTS.BLACK_INDEX?a.CONSTANTS.BLACK:a.CONSTANTS.WHITE:""}function w(b,c){var d,e,f=[],g={row:-1,col:-1};for(d=0;d<a.CONSTANTS.ROW;d+=1)for(e=0;e<a.CONSTANTS.COLUMN;e+=1)g.row=d,g.col=e,f=f.concat(t(b,g,c));return f.length>0}function x(b,d,e,g){b=b?angular.copy(b):B();var k,m,n,o=!1,q=!1,r=b[d.row][d.col].substr(1);if(!h(d)||!h(e))throw new Error(C.ILLEGAL_DELTA);if(i(b,d,e)?q=!0:j(b,d,e)&&(o=!0),q){if(w(b,g))throw new Error(C.ILLEGAL_IGNORE_MANDATORY_JUMP);if(k=s(b,d,g),!f(k,e))throw new Error(C.ILLEGAL_SIMPLE_MOVE)}else{if(!o)throw new Error(C.ILLEGAL_MOVE);var u=t(b,d,g);if(!f(u,e))throw new Error(C.ILLEGAL_JUMP_MOVE)}q?(b[e.row][e.col]=b[d.row][d.col],b[d.row][d.col]=a.CONSTANTS.DARK_SQUARE):o&&(n=p(d,e),b[e.row][e.col]=b[d.row][d.col],b[d.row][d.col]=a.CONSTANTS.DARK_SQUARE,b[n.row][n.col]=a.CONSTANTS.DARK_SQUARE);var x=l(e,g);x&&(c(b[e.row][e.col])===a.CONSTANTS.BLACK?b[e.row][e.col]=a.CONSTANTS.BLACK_KING:c(b[e.row][e.col])===a.CONSTANTS.WHITE&&(b[e.row][e.col]=a.CONSTANTS.WHITE_KING)),m=v(b,g);var y,z,A=o&&t(b,e,g).length>0;""===m||A?(y=null,z=A?x&&r!==a.CONSTANTS.KING?1-g:g:1-g):(z=-1,y=m===a.CONSTANTS.WHITE?[1,0]:[0,1]);var D={miniMoves:[{fromDelta:d,toDelta:e}],board:b};return{endMatchScores:y,turnIndexAfterMove:z,stateAfterMove:D}}function y(a,b,c){if(0===b.length)throw new Error("Must have at least one mini-move");for(var d=null,e=0,f=b;e<f.length;e++){var g=f[e];if(d&&d.turnIndexAfterMove!==c)throw new Error("Mini-moves must be done by the same player");d=x(a,g.fromDelta,g.toDelta,c),a=angular.copy(d.stateAfterMove.board)}return d.stateAfterMove.miniMoves=b,d}function z(){return{endMatchScores:null,turnIndexAfterMove:0,stateAfterMove:{miniMoves:[],board:B()}}}function A(a){var b=a.turnIndexBeforeMove,c=a.stateBeforeMove,d=a.move;if(c||0!==b||!angular.equals(z(),d)){var e=d.stateAfterMove,f=c?c.board:null,g=y(f,e.miniMoves,b);if(!angular.equals(d,g))throw new Error("Expected move="+angular.toJson(g,!0)+", but got stateTransition="+angular.toJson(a,!0))}}function B(){return[["--","BM","--","BM","--","BM","--","BM"],["BM","--","BM","--","BM","--","BM","--"],["--","BM","--","BM","--","BM","--","BM"],["DS","--","DS","--","DS","--","DS","--"],["--","DS","--","DS","--","DS","--","DS"],["WM","--","WM","--","WM","--","WM","--"],["--","WM","--","WM","--","WM","--","WM"],["WM","--","WM","--","WM","--","WM","--"]]}a.ENUM={ILLEGAL_CODE:{ILLEGAL_MOVE:"ILLEGAL_MOVE",ILLEGAL_SIMPLE_MOVE:"ILLEGAL_SIMPLE_MOVE",ILLEGAL_JUMP_MOVE:"ILLEGAL_JUMP_MOVE",ILLEGAL_DELTA:"ILLEGAL_DELTA",ILLEGAL_COLOR_CHANGED:"ILLEGAL_COLOR_CHANGED",ILLEGAL_CROWNED:"ILLEGAL_CROWNED",ILLEGAL_UNCROWNED:"ILLEGAL_UNCROWNED",ILLEGAL_IGNORE_MANDATORY_JUMP:"ILLEGAL_IGNORE_MANDATORY_JUMP",ILLEGAL_SET_TURN:"ILLEGAL_SET_TURN",ILLEGAL_END_MATCH_SCORE:"ILLEGAL_END_MATCH_SCORE",ILLEGAL_CODE:"ILLEGAL_CODE"},DIRECTION:{UP_LEFT:"UP_LEFT",UP_RIGHT:"UP_RIGHT",DOWN_LEFT:"DOWN_LEFT",DOWN_RIGHT:"DOWN_RIGHT"},MOVE_TYPE:{SIMPLE_MOVE:"SIMPLE_MOVE",JUMP_MOVE:"JUMP_MOVE"}};var C=a.ENUM.ILLEGAL_CODE,D=a.ENUM.DIRECTION,E=a.ENUM.MOVE_TYPE;a.CONSTANTS={ROW:8,COLUMN:8,LIGHT_SQUARE:"--",DARK_SQUARE:"DS",BLACK_MAN:"BM",BLACK_KING:"BK",WHITE_MAN:"WM",WHITE_KING:"WK",BLACK:"B",WHITE:"W",MAN:"M",KING:"K",WHITE_INDEX:0,BLACK_INDEX:1},a.isEmptyObj=b,a.getColor=c,a.getKind=d,a.isOwnColor=g,a.isSimpleMove=i,a.isJumpMove=j,a.getJumpedDelta=p,a.getSimpleMoves=s,a.getJumpMoves=t,a.getAllPossibleMoves=u,a.getWinner=v,a.hasMandatoryJumps=w,a.createMiniMove=x,a.createMove=y,a.createInitialMove=z,a.checkMoveOk=A,a.getInitialBoard=B}(gameLogic||(gameLogic={}));var game;!function(a){function b(){return{CHECKERS_RULES_TITLE:{en:"Rules of Checkers",iw:"כללים של משחק דמקה",pt:"Regras de Damas",zh:"英国跳棋规则",el:"Κανόνες Ντάμα",fr:"Règles de Checkers",hi:"चेकर्स के नियम",es:"Reglas de Damas"},CHECKERS_RULES_SLIDE1:{en:"Regular pieces move one step diagonally forward.",iw:"כל שחקן מניע בתורו אבן-משחק באלכסון",pt:"pedaços regulares mover um passo na diagonal para a frente.",zh:"定期件移动一步斜前方。",el:"Η τακτική κομμάτια προχωρήσουμε ένα βήμα διαγώνια προς τα εμπρός.",fr:"morceaux réguliers se déplacent d'un pas en diagonale avant.",hi:"नियमित रूप से टुकड़े एक कदम तिरछे आगे बढ़ना है।",es:"trozos regulares se mueven un paso en diagonal hacia delante."},CHECKERS_RULES_SLIDE2:{en:"A regular piece becomes a king when it reaches the final row. A king can also move backwards.",iw:'כשאבן משחק מגיעה לשורה האחרונה, היא הופכת להיות "מלך". מלך, בניגוד לאבן רגילה, יכול לנוע לכל הכיוונים באלכסון (כלומר גם אחורה).',pt:"Um pedaço comum torna-se um rei quando se atinge a linha final. Um rei também pode se mover para trás.",zh:"定期一块变成一个国王，当它到达最后一排。 A君也可以向后移动。",el:"Μια τακτική κομμάτι γίνεται βασιλιάς όταν φτάσει την τελική γραμμή. Ένας βασιλιάς μπορεί επίσης να κινηθεί προς τα πίσω.",fr:"Un morceau régulier devient un roi quand il atteint la dernière rangée. Un roi peut également se déplacer vers l'arrière.",hi:"एक नियमित रूप से टुकड़े के एक राजा जब यह अंतिम पंक्ति तक पहुँचता हो जाता है। एक राजा भी पीछे की ओर स्थानांतरित कर सकते हैं।",es:"Una pieza normal se convierte en un rey cuando se llega a la última fila. Un rey puede moverse hacia atrás."},CHECKERS_RULES_SLIDE3:{en:"Capturing is done jumping over adjacent opponent pieces. It's mandatory! Multiple successive jumps can zigzag, i.e., change diagonal direction.",iw:"דילוג (או אכילה) מתבצע כאשר אבן משחק מונחת במשבצת סמוכה לאבן היריב, ומעבר לאבן היריב יש מקום פנוי. כאשר דילוג אפשרי, חובה לבצע אותו.",pt:"Captura é feita a saltar sobre as peças oponente adjacentes. É obrigatório! Múltiplos saltos sucessivos pode ziguezague, ou seja, mudar de direção diagonal.",zh:"捕获完成后跳过相邻的对手件。这是强制性的！多个连续跳跃可以曲折，即改变对角线方向。",el:"Σύλληψη γίνεται άλμα πάνω από παρακείμενα κομμάτια του αντιπάλου. Είναι υποχρεωτική! Πολλαπλές διαδοχικές άλματα μπορεί να ζιγκ-ζαγκ, δηλαδή, να αλλάξει διαγώνια κατεύθυνση.",fr:"Capturing se fait sauter sur des morceaux adversaire adjacents. Il est obligatoire! sauts successifs multiples peuvent zigzag, à savoir, changer de direction diagonale.",hi:"कैप्चरिंग आसन्न प्रतिद्वंद्वी टुकड़े पर कूद किया जाता है। यह अनिवार्य है! एकाधिक लगातार कूदता है, वक्र कर सकते हैं जैसे कि, विकर्ण दिशा बदल जाते हैं।",es:"La captura se realiza saltando sobre las piezas adyacentes oponente. ¡Es obligatorio! saltos sucesivos múltiples pueden zigzag, es decir, cambiar de dirección diagonal."},CHECKERS_RULES_SLIDE4:{en:"A player that can't move or lost all its pieces, loses the game.",iw:"שחקן שלא יכול לזוז או שאיבד את כל האבנים, מפסיד את המשחק.",pt:"Um jogador que não pode se mover ou perdido todas as suas peças, perde o jogo.",zh:"不能移动或丧失其所有作品的球员，失去了比赛。",el:"Ένας παίκτης που δεν μπορεί να κινηθεί ή να χάσει όλα τα κομμάτια του, χάνει το παιχνίδι.",fr:"Un joueur qui ne peut pas se déplacer ou perdu toutes ses pièces, perd la partie.",hi:"एक खिलाड़ी है कि स्थानांतरित करने या खो नहीं कर सकते हैं अपने सभी टुकड़े, खेल खो देता है।",es:"Un jugador que no se puede mover o perdido todas sus piezas, pierde el juego."},CHECKERS_CLOSE:{en:"Close",iw:"סגור",pt:"Fechar",zh:"继续游戏",el:"Κοντά",fr:"Fermer",hi:"बंद करे",es:"Cerrar"}}}function c(){if(log.alwaysLog("Checkers version 1.1"),Q=document.getElementById("gameArea"),!Q)throw new Error("Can't find gameArea div!");translate.setTranslations(b()),translate.setLanguage("en"),console.log("Translation of 'CHECKERS_RULES_TITLE' is "+translate("CHECKERS_RULES_TITLE")),resizeGameAreaService.setWidthToHeight(1),moveService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,checkMoveOk:gameLogic.checkMoveOk,updateUI:f}),dragAndDropService.addDragListener("gameArea",I)}function d(){a.animationInterval&&($interval.cancel(a.animationInterval),a.animationInterval=null)}function e(){if(0==a.remainingAnimations.length)return d(),void g();var b=a.remainingAnimations.shift(),c=gameLogic.createMiniMove(a.board,b.fromDelta,b.toDelta,a.currentUpdateUI.turnIndexBeforeMove);if(a.board=c.stateAfterMove.board,0==a.remainingAnimations.length){var e=a.currentUpdateUI.move.stateAfterMove.board;if(!angular.equals(a.board,e))throw new Error("Animations ended in a different board: expected="+angular.toJson(e,!0)+" actual after animations="+angular.toJson(a.board,!0))}}function f(b){log.info("Game got updateUI:",b),a.didMakeMove=!1,a.currentUpdateUI=b,H(),a.humanMiniMoves=[];var c=!a.lastHumanMove||!angular.equals(b.move.stateAfterMove,a.lastHumanMove.stateAfterMove);a.lastHumanMove=null,a.shouldRotateBoard=1===b.playMode,d(),a.remainingAnimations=[],i()?(a.board=gameLogic.getInitialBoard(),n()&&h(gameLogic.createInitialMove())):c?(a.board=b.stateBeforeMove?b.stateBeforeMove.board:b.move.stateAfterMove.board,b.stateBeforeMove||angular.equals(a.board,gameLogic.getInitialBoard())||(a.board=gameLogic.getInitialBoard()),a.remainingAnimations=angular.copy(b.move.stateAfterMove.miniMoves),a.animationInterval=$interval(e,600)):(a.board=b.move.stateAfterMove.board,a.animationInterval=$interval(e,600))}function g(){if(l()){var b=aiService.createComputerMove(a.board,j(),{millisecondsLimit:500});log.info("Computer move: ",b),h(b)}}function h(b){a.didMakeMove||(a.didMakeMove=!0,moveService.makeMove(b))}function i(){return!a.currentUpdateUI.move.stateAfterMove}function j(){return a.currentUpdateUI.yourPlayerIndex}function k(){var b=a.currentUpdateUI.playersInfo[a.currentUpdateUI.yourPlayerIndex];return b&&""===b.playerId}function l(){return n()&&k()}function m(){return n()&&!k()&&0==a.remainingAnimations.length}function n(){return!a.didMakeMove&&a.currentUpdateUI.move.turnIndexAfterMove>=0&&a.currentUpdateUI.yourPlayerIndex===a.currentUpdateUI.move.turnIndexAfterMove}function o(a){switch(a){case P.COLUMN+1:return"move_up_left";case P.COLUMN-1:return"move_up_right";case-P.COLUMN+1:return"move_down_left";case-P.COLUMN-1:return"move_down_right";case 2*P.COLUMN+2:return"jump_up_left";case 2*P.COLUMN-2:return"jump_up_right";case-(2*P.COLUMN)+2:return"jump_down_left";case-(2*P.COLUMN)-2:return"jump_down_right"}return log.error("Internal error: illegal idDiff=",a),""}function p(b,c){if(0==a.remainingAnimations.length)return"";var d=a.remainingAnimations[0].fromDelta,e=a.remainingAnimations[0].toDelta,f={row:(d.row+e.row)/2,col:(d.col+e.col)/2},g=t({row:b,col:c});if(d.row===g.row&&d.col===g.col){var h=r(d.row,d.col),i=r(e.row,e.col),j=h-i;return o(a.shouldRotateBoard?-j:j)}return f.row===g.row&&f.col===g.col?"explodePiece":""}function q(b,c){if(log.info("makeMiniMove from:",b," to: ",c),m()){var d={fromDelta:b,toDelta:c},e=null;try{e=gameLogic.createMove(a.board,[d],j())}catch(f){return void log.info(["Move is illegal:",f])}$rootScope.$apply(function(){a.board=e.stateAfterMove.board,a.humanMiniMoves.push(d),e.turnIndexAfterMove!==a.currentUpdateUI.move.turnIndexAfterMove&&(a.lastHumanMove=e=gameLogic.createMove(a.currentUpdateUI.move.stateAfterMove.board,a.humanMiniMoves,j()),h(a.lastHumanMove))})}}function r(a,b){return a*P.COLUMN+b}function s(a,b){return(a+b)%2==1}function t(b){return a.shouldRotateBoard?{row:P.ROW-b.row-1,col:P.COLUMN-b.col-1}:b}function u(b,c){var d=t({row:b,col:c});return a.board[d.row][d.col]}function v(a){return a.indexOf("graph.facebook.com")>0}function w(a){return S&&v(a)?"http://multiplayer-gaming.appspot.com/proxy/?url="+encodeURIComponent(a):a}function x(){a.hadLoadingError||(a.hadLoadingError=!0,$rootScope.$apply())}function y(){return"file:"===location.protocol}function z(a){return a&&-1===a.indexOf("imgs/autoMatchAvatar.png")}function A(){if(a.hadLoadingError)return"";if(y())return"http://graph.facebook.com/10153589934097337/picture?height=300&width=300";var b=a.currentUpdateUI.playersInfo[j()];if(!b)return"";var c=b.avatarImageUrl;if(!z(c))return"";var d=c.match(/graph[.]facebook[.]com[\/](\w+)[\/]/);if(!d)return"";var e=d[1];return w("http://graph.facebook.com/"+e+"/picture?height=300&width=300")}function B(){return a.hadLoadingError?"":"transparent_board"}function C(a,b){return p(a,b)}function D(b,c){if(!a.dndStartPos)return K({row:b,col:c})?"can_drag_from_square":"";var d=t({row:a.dndStartPos.row,col:a.dndStartPos.col}),e=t({row:b,col:c});if(!m())return"";var f={fromDelta:d,toDelta:e};try{return gameLogic.createMove(a.board,[f],j()),"can_drop_on_square"}catch(g){}return""}function E(a,b){var c=F(a,b),d="";if(c){var e=u(a,b),f=gameLogic.getColor(e);d=" avatar_piece "+(f===P.BLACK?"lighter_avatar_piece":"darker_avatar_piece")}return"piece "+d}function F(b,c){if(a.hadLoadingError)return"";var d=u(b,c);if("--"==d||"DS"==d)return"";var e=gameLogic.getColor(d),f=e===P.BLACK?1:0,g=a.currentUpdateUI.playersInfo[f];if(!g)return"";var h=g.avatarImageUrl;return z(h)?w(h):y()?1==f?"http://graph.facebook.com/10153589934097337/picture":"http://graph.facebook.com/10153693068502449/picture":""}function G(a,b){var c=F(a,b);if(c)return c;var d=u(a,b),e="imgs/",f=".png";switch(d){case"BM":return e+"black_man"+f;case"BK":return e+"black_cro"+f;case"WM":return e+"white_man"+f;case"WK":return e+"white_cro"+f}return""}function H(){a.dndStartPos=null,a.dndElem&&a.dndElem.removeAttribute("style"),a.dndElem=null}function I(b,c,d){var e=N(),f=Math.min(Math.max(c-Q.offsetLeft,e.width/2),Q.clientWidth-e.width/2),g=Math.min(Math.max(d-Q.offsetTop,e.height/2),Q.clientHeight-e.height/2),h={top:g-.605*e.height,left:f-.605*e.width};if("touchmove"===b)return void(a.dndStartPos&&L(h,e));var i={row:Math.floor(P.ROW*g/Q.clientHeight),col:Math.floor(P.COLUMN*f/Q.clientWidth)};if("touchstart"!==b){if("touchend"===b&&a.dndStartPos){var j={row:a.dndStartPos.row,col:a.dndStartPos.col},k={row:i.row,col:i.col};q(t(j),t(k)),L(M(a.dndStartPos.row,a.dndStartPos.col,e),e),H()}"touchend"!==b&&"touchcancel"!==b&&"touchleave"!==b||(H(),$rootScope.$apply())}else if(K(i)){a.dndStartPos=i,a.dndElem=document.getElementById("img_container_"+a.dndStartPos.row+"_"+a.dndStartPos.col);var l=a.dndElem.style;l["z-index"]=20;var m="scale(1.2)";l.transform=m,l["-webkit-transform"]=m,L(h,e),$rootScope.$apply()}}function J(b){return gameLogic.isOwnColor(j(),a.board[b.row][b.col].substring(0,1))}function K(b){var c=t(b);if(!m()||!J(c))return!1;if(!gameLogic.isOwnColor(j(),a.board[c.row][c.col].substr(0,1)))return!1;var d,e=gameLogic.hasMandatoryJumps(a.board,j());return d=e?gameLogic.getJumpMoves(a.board,c,j()):gameLogic.getSimpleMoves(a.board,c,j()),d.length>0}function L(b,c){var d=c.height/10,e=c.width/10,f=M(a.dndStartPos.row,a.dndStartPos.col,c);null!==a.dndElem&&(a.dndElem.style.left=b.left-f.left+e+"px",a.dndElem.style.top=b.top-f.top+d+"px")}function M(a,b,c){var d=a*c.height,e=b*c.width,f={top:d,left:e};return f}function N(){return{width:Q.clientWidth/P.COLUMN,height:Q.clientHeight/P.ROW}}function O(b){return b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.isHelpModalShown=!1),!0}a.isHelpModalShown=!1;var P=gameLogic.CONSTANTS,Q=null;a.currentUpdateUI=null,a.board=null,a.shouldRotateBoard=!1,a.didMakeMove=!1,a.humanMiniMoves=[],a.lastHumanMove=null,a.remainingAnimations=[],a.animationInterval=null,a.dndStartPos=null,a.dndElem=null,a.init=c,a.updateUI=f,a.getAnimationClass=p,a.isDarkCell=s;var R=navigator.userAgent.toLowerCase(),S=R.indexOf("iphone")>-1||R.indexOf("ipod")>-1||R.indexOf("ipad")>-1;a.hadLoadingError=!1,a.onImgError=x,a.getBoardAvatar=A,a.getBoardClass=B,a.getPieceContainerClass=C,a.getSquareClass=D,a.getPieceClass=E,a.getAvatarPieceSrc=F,a.getPieceSrc=G,a.clickedOnModal=O}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,game.init()});var aiService;!function(a){function b(a,b,c){return gameLogic.getKind(a)===i.MAN?gameLogic.getColor(a)===i.WHITE?1===b?7:5:c===i.ROW-2?7:5:gameLogic.getKind(a)===i.KING?10:0}function c(a,c){var d,e,f,g,h,j=0,k=[[0,4,0,4,0,4,0,4],[4,0,3,0,3,0,3,0],[0,3,0,2,0,2,0,4],[4,0,2,0,1,0,3,0],[0,3,0,1,0,2,0,4],[4,0,2,0,2,0,3,0],[0,3,0,3,0,3,0,4],[4,0,4,0,4,0,4,0]];if(d=gameLogic.getWinner(a,c),d===i.WHITE)return Number.MIN_VALUE;if(d===i.BLACK)return Number.MAX_VALUE;for(g=0;g<i.ROW;g+=1)for(h=0;h<i.COLUMN;h+=1)e=a[g][h],e!==i.LIGHT_SQUARE&&e!==i.DARK_SQUARE&&(f=b(e,g,h)*k[g][h],gameLogic.getColor(e)===i.BLACK?j+=f:j-=f);return j}function d(a,b){return-c(a.stateAfterMove.board,b)}function e(a,b,c,d){for(var e=gameLogic.getJumpMoves(b,d,c),f=0,g=e;f<g.length;f++){for(var h=g[f],i=[],j=d,k=h,l=b;;){var m=gameLogic.createMiniMove(l,j,k,c);if(i.push({fromDelta:j,toDelta:k}),m.turnIndexAfterMove!==c)break;l=m.stateAfterMove.board,j=k,k=gameLogic.getJumpMoves(l,k,c)[0]}a.push(i)}}function f(a,b){for(var c=[],d=gameLogic.hasMandatoryJumps(a,b),f=0;f<i.ROW;f+=1)for(var g=0;g<i.COLUMN;g+=1)if(gameLogic.isOwnColor(b,a[f][g].substr(0,1))){var h={row:f,col:g};if(d)e(c,a,b,h);else for(var j=gameLogic.getSimpleMoves(a,h,b),k=0,l=j;k<l.length;k++){var m=l[k];c.push([{fromDelta:h,toDelta:m}])}}return c}function g(a,b){for(var c=a.stateAfterMove.board,d=f(c,b),e=[],g=0;g<d.length;g++)e[g]=gameLogic.createMove(angular.copy(c),d[g],b);return e}function h(a,b,c){return alphaBetaService.alphaBetaDecision({stateAfterMove:{board:a?a:gameLogic.getInitialBoard(),miniMoves:[]},endMatchScores:null,turnIndexAfterMove:null},b,g,d,null,c)}var i=gameLogic.CONSTANTS;a.createComputerMove=h}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map